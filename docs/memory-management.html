<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Memory Management - Game Engine Docs</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="objects.html"><strong aria-hidden="true">1.</strong> GameObjects</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="object-scripting.html"><strong aria-hidden="true">1.1.</strong> Scripting</a></li></ol></li><li class="chapter-item expanded "><a href="coroutines.html"><strong aria-hidden="true">2.</strong> Coroutines</a></li><li class="chapter-item expanded "><a href="memory-management.html" class="active"><strong aria-hidden="true">3.</strong> Memory Management</a></li><li class="chapter-item expanded "><a href="api-ref.html"><strong aria-hidden="true">4.</strong> API</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="api/system.html"><strong aria-hidden="true">4.1.</strong> System</a></li><li class="chapter-item expanded "><a href="api/time.html"><strong aria-hidden="true">4.2.</strong> Time</a></li><li class="chapter-item expanded "><a href="api/audio.html"><strong aria-hidden="true">4.3.</strong> Audio</a></li></ol></li><li class="chapter-item expanded "><a href="api/system/exit.html">ㅤ</a></li><li class="chapter-item expanded affix "><a href="api/system/sleep.html">ㅤ</a></li><li class="chapter-item expanded affix "><a href="api/time/duration.html">ㅤ</a></li><li class="chapter-item expanded affix "><a href="api/time/duration/constructor.html">ㅤ</a></li><li class="chapter-item expanded affix "><a href="api/audio/playsound.html">ㅤ</a></li><li class="chapter-item expanded affix "><a href="api/audio/playmusic.html">ㅤ</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Game Engine Docs</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="memory-management"><a class="header" href="#memory-management">Memory Management</a></h1>
<p>Everyone's favourite topic to argue about, memory management. This page will go over the custom memory allocators the engine uses, why, and most importantly, what they do.</p>
<p>Below are some sources, which explain each allocator as well as provide basic implementation details:</p>
<p><a href="https://www.gingerbill.org/article/2019/02/01/memory-allocation-strategies-001/">Memory Allocation Strategies - Part 1</a></p>
<p><a href="https://www.gingerbill.org/article/2019/02/08/memory-allocation-strategies-002/">Memory Allocation Strategies - Part 2</a></p>
<p><a href="https://www.gingerbill.org/article/2019/02/15/memory-allocation-strategies-003/">Memory Allocation Strategies - Part 3</a></p>
<p><a href="https://www.rfleury.com/p/untangling-lifetimes-the-arena-allocator">Untangling Lifetimes: The Arena Allocator</a></p>
<p>With that said, let's look at the first two allocators</p>
<h2 id="the-arena-allocator"><a class="header" href="#the-arena-allocator">The Arena Allocator</a></h2>
<p>Also known as a linear allocator, the arena allocator is very simple in concept. You have a large array of bytes available, and an offset within the array. To allocate an object, you return the array pointer plus the offset, and increase the offset by the size of the object. You cannot free individual items, but instead you clear the whole arena at once.</p>
<p>Due to the way that computers read memory, the engine's implementation of arena allocation gains performance at the cost of space. Computers read multiple bytes of memory at once, but can only do it at regular intervals. This is known as <a href="https://en.wikipedia.org/wiki/Data_structure_alignment">n-byte alignment</a>, and allows the CPU to read memory faster. This means that we must pad each allocation to make sure it has the correct alignment - for example, if we allocate a single byte, we must pad the next allocation to align it.</p>
<p>In reality, memory arenas become slightly more complex when object-oriented programming is introduced. This is why the engine exposes two arena allocators:</p>
<ul>
<li><code>arena</code> - uses extra memory to store type information for each allocation, allowing constructors and destructors to be called when required.</li>
<li><code>fast_arena</code> - a more barebones approach that does not call destructors, so is more appropriate for primitives, or C-style programming.</li>
</ul>
<p>Both allocators expose the same functions, which are listed below:</p>
<ul>
<li><code>arena(const size_t size)</code> / <code>fast_arena(const size_t size)</code> - constructs the arena, allocating an internal buffer of <code>size</code> bytes</li>
<li><code>T* allocate(</code> - allocates an object of type <code>T</code>, in <code>arena</code> a struct containing type information is pushed to a seperate stack</li>
<li><code>void clear</code> - clears the memory arena, in <code>fast_arena</code>, this simply resets the offset, in <code>arena</code>, it pops each element from the seconds stack and uses the type information to call destructors correctly</li>
</ul>
<h2 id="the-stack-allocator"><a class="header" href="#the-stack-allocator">The Stack Allocator</a></h2>
<p>A stack allocator is very similar to an arena allocator, with a few key differences that change its use. When a new element is pushed, a header is added to the storage that provides enough information so that you can pop items off of the stack, rather than only being able to clear it. This has a very slight size and speed overhead, but can be much more useful when used correctly.</p>
<p>Below are the member functions of the stack allocator:</p>
<ul>
<li><code>stack(const size_t size)</code> - constructs the stack, allocating an internal buffer of <code>size</code> bytes</li>
<li><code>T* allocate</code> - allocates an object of type <code>T</code></li>
<li><code>void free</code></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="coroutines.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="api-ref.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="coroutines.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="api-ref.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
